<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="checkers.css">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<div class="center-screen" id="status">It is whites turn</div>

<table id ="board" class="center-screen">
    <tr>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
    </tr>
    <tr>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
    </tr>
    <tr>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
    </tr>
    <tr>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="black-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
    </tr>
    <tr>
        <th class="whiteSquare"  onclick="clickCell(this)"></th>
        <th class="blackSquare"  onclick="clickCell(this)"></th>
        <th class="whiteSquare"  onclick="clickCell(this)"></th>
        <th class="blackSquare"  onclick="clickCell(this)"></th>
        <th class="whiteSquare"  onclick="clickCell(this)"></th>
        <th class="blackSquare"  onclick="clickCell(this)"></th>
        <th class="whiteSquare"  onclick="clickCell(this)"></th>
        <th class="blackSquare"  onclick="clickCell(this)"></th>
        <th class="whiteSquare"  onclick="clickCell(this)"></th>
        <th class="blackSquare"  onclick="clickCell(this)"></th>
    </tr>
    <tr>
        <th class="blackSquare"  onclick="clickCell(this)"></th>
        <th class="whiteSquare"  onclick="clickCell(this)"></th>
        <th class="blackSquare"  onclick="clickCell(this)"></th>
        <th class="whiteSquare"  onclick="clickCell(this)"></th>
        <th class="blackSquare"  onclick="clickCell(this)"></th>
        <th class="whiteSquare"  onclick="clickCell(this)"></th>
        <th class="blackSquare"  onclick="clickCell(this)"></th>
        <th class="whiteSquare"  onclick="clickCell(this)"></th>
        <th class="blackSquare"  onclick="clickCell(this)"></th>
        <th class="whiteSquare"  onclick="clickCell(this)"></th>
    </tr>
    <tr>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"> <img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
    </tr>
    <tr>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"> <img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
    </tr>
    <tr>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"> <img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
    </tr>
    <tr>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"> <img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
        <th class="blackSquare" onclick="clickCell(this)"><img src="white-stone.png"></th>
        <th class="whiteSquare" onclick="clickCell(this)"></th>
    </tr>

    <input  id="fromRow"  value="99">
    <input  id="fromColumn"  value="99">
</table>

<script>

    const itIsWhitesTurn = 'It is whites turn';
    const whiteIsMoving = 'White is moving';
    const itIsBlacksTurn= 'It is blacks turn';
    const blackIsMoving = 'Black is moving';

    function clickCell(cell) {
        log(cell);
        if(shouldSelectStone()) {
            selectStone(cell);
        }
        else {
            moveStone(cell);
        }
    }

    function selectStone(cell){
        if(canSelectWhite(cell)){
            selectWhiteStone(cell);
        }
        if(canSelectBlack(cell)){
            selectBlackstone(cell);
        }
    }

    function selectWhiteStone(cell){
        basicSelect(cell);
        setStatus(whiteIsMoving);
    }

    function selectBlackstone(cell){
        basicSelect(cell);
        setStatus(blackIsMoving);
    }

    function basicSelect(cell){
        cell.innerHTML = '';
        document.getElementById("fromRow").value = cell.parentNode.rowIndex;
        document.getElementById("fromColumn").value = cell.cellIndex;
    }

    function moveStone(cell){
        if(cellIsEmpty(cell) && getStatus() == whiteIsMoving) {
            moveWhiteStone(cell);
        }
        if(cellIsEmpty(cell) && getStatus() == blackIsMoving) {
            moveBlackStone(cell);
        }
    }

    function canSelectWhite(cell){
        return  getStatus() ==  itIsWhitesTurn && cellHasWhiteStoneOnIt(cell) && canDoAnyMove(cell, true);
    }


    function canSelectBlack(cell){
        return  getStatus() ==  itIsBlacksTurn && cellHasBlackStoneOnIt(cell) && canDoAnyMove(cell, false)
    }

    function canDoAnyMove(fromCell, isWhite){
        const board = document.getElementById("board");
        for (let row = 0; row < board.rows.length; row++) {
            for (let column = 0; column < board.rows[row].cells.length; column++) {
                const toCell = getCell(row, column);
                if(canDoMove(fromCell, toCell,  isWhite)){
                    return true;
                }
            }
        }
        return false;
    }

    function canDoMove(fromCell, toCell, isWhite){
        if(!cellIsEmpty(toCell)){
            return false;
        }
        if(canDoAnyHit(fromCell, isWhite)){
            return canHit(fromCell, toCell, isWhite)
        }
        return !canADifferentStoneHit() && canDoBasicMove(fromCell, toCell, isWhite)
    }

    function canDoBasicMove(fromCell, toCell, isWhite){
        const validColumnMove =  (toCell.cellIndex == fromCell.cellIndex+1 || toCell.cellIndex == fromCell.cellIndex-1);
        if(isWhite){
            return validColumnMove && toCell.parentNode.rowIndex == fromCell.parentNode.rowIndex -1;
        }
        return validColumnMove && toCell.parentNode.rowIndex == fromCell.parentNode.rowIndex +1;
    }

    function canDoAnyHit(fromCell, isWhite){
        const board = document.getElementById("board");
        for (let row = 0; row < board.rows.length; row++) {
            for (let column = 0; column < board.rows[row].cells.length; column++) {
                const toCell = getCell(row, column);
                if(canHit(fromCell, toCell,  isWhite)){
                    return true;
                }
            }
        }
        return false;
    }

    function canADifferentStoneHit(isWhite){
        const cells = getAllCellFromColor(isWhite);
        for (const cell of cells) {
            if(canDoAnyHit(cell, isWhite)){
                return true;
            }
        }
        return false;
    }

    function getAllCellFromColor(isWhite){
        let cellArray = new Array();
        const board = document.getElementById("board");
        for (let row = 0; row < board.rows.length; row++) {
            for (let column = 0; column < board.rows[row].cells.length; column++) {
                cellArray.concat()
                const cell = getCell(row, column);

                if(isWhite && cellHasWhiteStoneOnIt(cell)){
                    cellArray.push(cell);
                }
                if(!isWhite && cellHasBlackStoneOnIt(cell)){
                    cellArray.push(cell);
                }
            }
        }
        return cellArray
    }

    function canHit(fromCell, toCell, isWhite){
        const validColumnMove =  (toCell.cellIndex == fromCell.cellIndex+2 || toCell.cellIndex == fromCell.cellIndex-2);
        const validRowMove = (toCell.parentNode.rowIndex == fromCell.parentNode.rowIndex +2 || toCell.parentNode.rowIndex == fromCell.parentNode.rowIndex -2);
        if(isWhite){
            return validColumnMove && validRowMove && cellHasBlackStoneOnIt(getCellInBetween(fromCell, toCell));
        }
        return validColumnMove && validRowMove &&  cellHasWhiteStoneOnIt(getCellInBetween(fromCell, toCell));
    }

    function getCellInBetween(fromCell, toCell){
        const cellInBetweenRow = fromCell.parentNode.rowIndex + (((toCell.parentNode.rowIndex - fromCell.parentNode.rowIndex) / 2));
        const cellInBetweenColumn = fromCell.cellIndex +  (((toCell.cellIndex - fromCell.cellIndex) / 2));
        return getCell(cellInBetweenRow, cellInBetweenColumn);
    }



    function getFromRow(){
        return   document.getElementById("fromRow").value;
    }

    function getFromColumn(){
        return  document.getElementById("fromColumn").value;
    }

    function getCell(row, column){
        return  document.getElementById("board").rows[row].cells[column];
    }

    function moveWhiteStone(toCell){
        const fromCell = getCell(getFromRow(), getFromColumn());
        if(canDoMove(fromCell, toCell, true)) {
            if(canHit(fromCell, toCell, true)){
                getCellInBetween(fromCell, toCell).innerHTML = '';
            }
            toCell.innerHTML = '<img src="white-stone.png">';
            setStatus(itIsBlacksTurn);
        }
    }

    function moveBlackStone(toCell){
        const fromCell = getCell(getFromRow(), getFromColumn());
        if(canDoMove(fromCell, toCell, false)) {
            if(canHit(fromCell, toCell, false)){
                getCellInBetween(fromCell, toCell).innerHTML = '';
            }
            toCell.innerHTML = '<img src="black-stone.png">';
            setStatus(itIsWhitesTurn);
        }
    }




    function shouldSelectStone(){
        return getStatus() == itIsWhitesTurn || getStatus() == itIsBlacksTurn;
    }

    function getStatus(){
        return getStatusDiv().innerText

    }

    function setStatus(status){
        getStatusDiv().innerHTML = status
    }

    function getStatusDiv(){
        return  document.getElementById("status");
    }

    function cellIsEmpty(cell){
        return cell.lastChild == null;
    }

    function cellHasWhiteStoneOnIt(cell){
        return !cellIsEmpty(cell) &&  cell.lastChild.src.endsWith('white-stone.png')
    }

    function cellHasBlackStoneOnIt(cell){
        return !cellIsEmpty(cell) &&  cell.lastChild.src.endsWith('black-stone.png')
    }


    function log(cell){
        const celIndex = cell.cellIndex;
        const rowIndex = cell.parentNode.rowIndex;


        console.log("clicked my function row is: "+ rowIndex + " column is: "+ celIndex, cell.innerHTML);
        console.log("Cell has white stone on it: "+ cellHasWhiteStoneOnIt(cell));
        console.log("Cell is empty: "+ cellIsEmpty(cell));
        console.log("Status of game is: "+ getStatus());
        console.log("white cells: "+ getAllCellFromColor(true));
    }

</script>

</body>



</html>